<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testcontainers in Spring Boot: Van Snelle Winst tot Geavanceerde Zetten | Oumi's Blog</title>
    <meta name="description" content="Thoughtful reflections on software development, written by a developer for developers.
">


    <link rel="canonical" href="http://localhost:4000/nl/2025/10/05/testcontainers/" />

    <meta property="og:title" content="Testcontainers in Spring Boot: Van Snelle Winst tot Geavanceerde Zetten" />
    <meta property="og:description" content="Thoughtful reflections on software development, written by a developer for developers.
" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="http://localhost:4000/nl/2025/10/05/testcontainers/" />
    
    <meta property="og:image" content="http://localhost:4000/assets/img/spongebob-testcontainers.png" />
    

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Testcontainers in Spring Boot: Van Snelle Winst tot Geavanceerde Zetten" />
    <meta name="twitter:description" content="Thoughtful reflections on software development, written by a developer for developers.
" />
    
    <meta name="twitter:image" content="http://localhost:4000/assets/img/spongebob-testcontainers.png" />
    

    <script>
      // Blocking script to prevent FOUC (Flash of Unstyled Content)
      // Must run before CSS loads to apply theme immediately
      (function() {
        var theme = localStorage.getItem('theme');
        if (theme) {
          document.documentElement.setAttribute('data-theme', theme);
        }
      })();
    </script>

    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="icon" type="image/x-icon" href="/assets/favicon/favicon.ico">

    <!-- Google Analytics - loaded conditionally based on cookie consent -->
    <script id="ga-script" type="text/plain" data-consent="analytics">
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-6X9TVDQMN7', { 'anonymize_ip': true });
    </script>
</head>
<body>

<div id="live-announcer" role="status" aria-live="polite" aria-atomic="true" class="sr-only"></div>

<a href="#main-content" class="skip-link">Skip to main content</a><header class="site-header">
  <div class="wrapper">
    
    

    
      <a class="site-title" href="/">
        <img src="/assets/favicon/logo.svg" alt="Oumi's Blog" class="site-logo">
        <span class="site-title-text">Oumi's Blog</span>
      </a>
    

    <button class="hamburger mobile-only" id="hamburger-toggle" aria-label="Toggle menu" aria-expanded="false">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>

    <nav class="site-nav" role="navigation" aria-label="Main navigation">
      <a href="/nl/posts">Posts</a>
      <a href="/nl/about">About</a>

      <div class="lang-switcher desktop-only" role="group" aria-label="Language switcher">
        <button class="lang-link" data-lang="en" id="lang-en" aria-label="Switch to English" aria-pressed="false">EN</button>
        <span class="lang-separator" aria-hidden="true">/</span>
        <button class="lang-link" data-lang="nl" id="lang-nl" aria-label="Switch to Dutch" aria-pressed="true">NL</button>
      </div>

      <button id="theme-toggle" class="desktop-only" aria-label="Switch to dark theme">
        <svg id="icon-sun" class="hidden"
             xmlns="http://www.w3.org/2000/svg" width="20" height="20"
             viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             aria-hidden="true" focusable="false">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>

        <svg id="icon-moon" class="hidden"
             xmlns="http://www.w3.org/2000/svg" width="20" height="20"
             viewBox="0 0 24 24" fill="currentColor"
             aria-hidden="true" focusable="false">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
      </button>

      <div class="mobile-only mobile-controls">
        <button class="mobile-action" id="mobile-switch-theme">Switch theme</button>
        
        <a class="mobile-action" href="/">Switch to English</a>
        
      </div>
    </nav>
  </div>
</header>
<main id="main-content">
    <div class="wrapper">
        <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Testcontainers in Spring Boot: Van Snelle Winst tot Geavanceerde Zetten",
  "description": "  “Testcontainers is like having SpongeBob at the helm of your CI: cheerful, reliable, and somehow turning chaos into perfection.” - Me",
  "author": {
    "@type": "Person",
    "name": "Oumaima Zerouali",
    "url": "http://localhost:4000"
  },
  "datePublished": "2025-10-05T09:00:00+02:00",
  "dateModified": "2025-10-05T09:00:00+02:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:4000/nl/2025/10/05/testcontainers/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Oumi's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:4000/assets/favicon/logo.svg"
    }
  },
  "image": {
    "@type": "ImageObject",
    "url": "http://localhost:4000/assets/img/spongebob-testcontainers.png"
  }
}
</script>



<article class="post">
    
    
    <div class="post-hero">
        <img
            src="/assets/img/spongebob-testcontainers.png"
            alt="Featured image for Testcontainers in Spring Boot: Van Snelle Winst tot Geavanceerde Zetten"
            loading="eager"
        />
    </div>
    

    <div class="post-container">
        
        <div class="post-main">
            <header class="post-header">
                <h1 class="post-title">Testcontainers in Spring Boot: Van Snelle Winst tot Geavanceerde Zetten</h1>
                <div class="post-meta-inline">
                    <time datetime="2025-10-05T09:00:00+02:00">October 05, 2025</time>
                    
                    <div class="post-tags-inline">
                        
                        <span class="tag">java</span>
                        
                        <span class="tag">spring-boot</span>
                        
                        <span class="tag">testing</span>
                        
                    </div>
                    
                </div>
            </header>

            <div class="post-content">
                <blockquote>
  <p>“Testcontainers is like having SpongeBob at the helm of your CI: cheerful, reliable, and somehow turning chaos into perfection.” - Me</p>
</blockquote>

<p>Als junior developer ben ik constant nieuwe tools en werkwijzen aan het leren.<br />
Een les van mijn senioren die echt bij me bleef hangen was deze: <em>mocking brengt je maar tot een bepaald punt</em>.<br />
Op een gegeven moment moet je testen tegen het echte werk: een echte database, een echte message broker, een echte service.</p>

<p>Toen ontdekte ik <strong>Testcontainers</strong>, en het veranderde volledig hoe ik integratietests schrijf in Java en Spring Boot.<br />
Na ermee te hebben geëxperimenteerd en mijn bevindingen te hebben gedeeld met collega’s, besefte ik dat ik alles wat ik had geleerd op één plek wilde vastleggen.</p>

<p>Deze post is mijn poging dat te doen: het uitleggen van het <strong>waarom</strong>, het <strong>hoe</strong>, en de <strong>praktijkpatronen</strong> die ik nu in mijn projecten gebruik.</p>

<h2 id="het-probleem-dat-ik-eerder-had">Het Probleem dat Ik Eerder Had</h2>
<p>Ik moet toegeven:<br />
ik probeerde integratietests altijd te vermijden wanneer ik kon.<br />
Mocks waren mijn beste vrienden: snel, voorspelbaar, en makkelijk op te zetten.</p>

<p>Maar hoe graag ik ze ook gebruikte, sommige dingen kun je gewoon niet faken.<br />
Een mailserver, een echte PostgreSQL-database — geen enkele mock kon dat echt repliceren.</p>

<p>Ik liep al snel tegen dezelfde frustrerende scenario’s aan die we allemaal kennen: tests die op mijn machine slagen maar falen in CI, of collega’s die uren besteden aan het klaarmaken van de omgeving om tests te kunnen draaien.</p>

<p>Voor een Spring Boot-app die PostgreSQL nodig heeft en e-mails verstuurt, zien de opties er zo uit:</p>

<table>
  <thead>
    <tr>
      <th>Benadering</th>
      <th>Voordelen</th>
      <th>Nadelen</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Lokale installatie</strong><br />Installeer PostgreSQL &amp; SMTP lokaal</td>
      <td>- Testen tegen echte services<br /> - Geen mocking nodig</td>
      <td>- Verschillende versies op verschillende machines<br /> - “Werkt op mijn laptop” syndroom<br /> - Pijnlijke CI-setup<br /> - Achtergebleven testdata</td>
    </tr>
    <tr>
      <td><strong>Alles mocken</strong><br />Gebruik mock databases &amp; services</td>
      <td>- Snelle testuitvoering<br /> - Geen externe afhankelijkheden</td>
      <td>- Test geen echte integratie<br /> - Mocks wijken af van de werkelijkheid<br /> - Valse zekerheid</td>
    </tr>
    <tr>
      <td><strong>Testcontainers</strong><br />Echte services in Docker</td>
      <td>- Echte integratietests<br /> - Consistent op alle machines<br /> - Geen installatie gedoe<br /> - Schone staat bij elke run</td>
      <td>- Vereist Docker<br /> - Iets langzamer dan mocks</td>
    </tr>
  </tbody>
</table>

<p><strong>Testcontainers</strong> was de game-changer die ik nodig had.</p>

<h2 id="snel-aan-de-slag">Snel aan de Slag</h2>

<p>Voordat ik dieper inga, eerst een setup:</p>

<p><strong>Vereisten:</strong></p>
<ul>
  <li>Java <strong>21+</strong></li>
  <li>Maven</li>
  <li>Docker Desktop draaiend</li>
</ul>

<p><strong>Dependencies toevoegen:</strong></p>

<p>Maven:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.testcontainers<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>junit-jupiter<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.testcontainers<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>postgresql<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<h2 id="de-standaardaanpak-goed-maar-beperkt">De Standaardaanpak (Goed, Maar Beperkt)</h2>

<p>De meeste tutorials laten dit zien, en eerlijk, het werkt prima voor eenvoudige cases:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Testcontainers</span>
<span class="nd">@DataJpaTest</span>
<span class="kd">class</span> <span class="nc">UserRepositoryTest</span> <span class="o">{</span>

    <span class="nd">@Container</span>
    <span class="kd">static</span> <span class="nc">PostgreSQLContainer</span><span class="o">&lt;?&gt;</span> <span class="n">postgres</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PostgreSQLContainer</span><span class="o">&lt;&gt;(</span><span class="s">"postgres:16-alpine"</span><span class="o">);</span>
    
    <span class="nd">@DynamicPropertySource</span>
    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">configureProperties</span><span class="o">(</span><span class="nc">DynamicPropertyRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.datasource.url"</span><span class="o">,</span> <span class="nl">postgres:</span><span class="o">:</span><span class="n">getJdbcUrl</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.datasource.username"</span><span class="o">,</span> <span class="nl">postgres:</span><span class="o">:</span><span class="n">getUsername</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.datasource.password"</span><span class="o">,</span> <span class="nl">postgres:</span><span class="o">:</span><span class="n">getPassword</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="nd">@Autowired</span>
    <span class="nc">UserRepository</span> <span class="n">userRepository</span><span class="o">;</span>
    
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">givenNewUser_whenSaving_thenUserIsPersisted</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="s">"Spongebob"</span><span class="o">);</span>
        <span class="n">userRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">().</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Perfect voor eenvoudige gevallen. JUnit start een PostgreSQL-container, Spring Boot configureert deze via <code class="language-plaintext highlighter-rouge">@DynamicPropertySource</code>, de test draait tegen een echte database, en de container wordt netjes opgeruimd na afloop.</p>

<h3 id="wat-gebeurt-er-achter-de-schermen">Wat Gebeurt Er Achter de Schermen?</h3>

<p>Wanneer je op “Run Test” klikt, gebeurt dit (vereenvoudigd):</p>

<p align="center">
    <img src="/assets/img/simplified.svg" alt="Achter de schermen (vereenvoudigd)" style="height: 550px" />
</p>

<p>Het wachten is cruciaal.
Testcontainers kijkt niet alleen of de poort open is, maar wacht totdat de service daadwerkelijk klaar is om verbindingen te accepteren.
Daarom werken je tests “gewoon” zonder flakey failures.</p>

<p>Maar in echte projecten liep ik al snel tegen situaties aan waarbij ik moest:</p>

<ul>
  <li>Meerdere containers starten die met elkaar praten</li>
  <li>Mijn database vooraf vullen met schema of seed data</li>
  <li>Wachten tot een REST API klaar is, niet alleen een poort</li>
  <li>E-mails testen tegen een fake SMTP-server</li>
</ul>

<p>Daar wordt het pas interessant…</p>

<h2 id="volgende-stap-applicationcontextinitializer">Volgende Stap: ApplicationContextInitializer</h2>

<p>Wanneer ik meer controle nodig heb, biedt Spring Boot een krachtige hook:
<strong><code class="language-plaintext highlighter-rouge">ApplicationContextInitializer&lt;ConfigurableApplicationContext&gt;</code></strong>.</p>

<p>Dit draait <strong>voordat</strong> je applicatiecontext start, en laat je toe om:</p>

<ul>
  <li>Containers handmatig te starten met volledige controle</li>
  <li>Complexe wachtstrategieën te configureren</li>
  <li>Custom properties in Spring’s environment te injecteren</li>
  <li>Containerconfiguraties te hergebruiken over meerdere testklassen</li>
</ul>

<p>Ik zie dit als de “professionele” manier om Testcontainers in Spring Boot op te zetten.</p>

<h3 id="hoe-de-professionele-setup-werkt">Hoe de Professionele Setup Werkt</h3>

<p>Wanneer je <code class="language-plaintext highlighter-rouge">ApplicationContextInitializer</code> gebruikt, gebeurt dit:</p>

<p align="center">
    <img src="/assets/img/testcontainers.svg" alt="Wat gebeurt bij ApplicationContextInitializer" style="height: 550px" />
</p>

<p>Je krijgt volledige controle over de opstartvolgorde en kunt containers precies configureren zoals jij wilt.</p>

<h3 id="praktijkvoorbeeld-e-mails-testen-met-smtp4dev-of-mailpit">Praktijkvoorbeeld: E-mails testen met smtp4dev (of Mailpit)</h3>

<p>Mijn app verstuurt e-mails, en ik moest realistisch testen zonder echte inboxen te spammen.</p>

<p><strong>smtp4dev</strong> is een fake SMTP-server die e-mails opvangt en via een REST API beschikbaar stelt.
Het bestaat al jaren, is volwassen en biedt features zoals relay-testing en authenticatiesimulatie.
Perfect voor uitgebreide e-mailtests.</p>

<p><strong>Mailpit</strong> is een modern alternatief geschreven in Go: lichter, sneller opstartend, en met een strakke UI.
Ook uitstekende zoekfunctionaliteit en ingebouwde spam-analyse.
Voor nieuwe projecten in 2025 is Mailpit vaak de go-to, maar smtp4dev blijft solide voor bestaande projecten.</p>

<p>Beide bieden REST APIs, ondersteunen SMTP-authenticatie en hebben een web UI voor handmatige inspectie.
Belangrijkste verschillen:</p>

<ul>
  <li><strong>Performance</strong>: Mailpit start sneller en gebruikt minder geheugen (~10-20MB vs ~50-100MB)</li>
  <li><strong>UI</strong>: Mailpit heeft een moderne, responsive interface</li>
  <li><strong>Features</strong>: smtp4dev heeft meer enterprise-features; Mailpit focust op eenvoud</li>
  <li><strong>Docker grootte</strong>: Mailpit image is kleiner (~15MB vs ~200MB)</li>
</ul>

<p>Voor de meeste Spring Boot integratietests werkt beide prima.
Hier laat ik smtp4dev zien, maar switchen naar Mailpit is simpel door de image naam te veranderen.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Smtp4devTestContainerInitializer</span> <span class="kd">implements</span> <span class="nc">ApplicationContextInitializer</span><span class="o">&lt;</span><span class="nc">ConfigurableApplicationContext</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">GenericContainer</span><span class="o">&lt;?&gt;</span> <span class="n">smtp4devContainer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GenericContainer</span><span class="o">&lt;&gt;(</span><span class="nc">DockerImageName</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"rnwood/smtp4dev:3.10.3"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">withExposedPorts</span><span class="o">(</span><span class="mi">80</span><span class="o">,</span> <span class="mi">25</span><span class="o">)</span>
        <span class="o">.</span><span class="na">waitingFor</span><span class="o">(</span><span class="nc">Wait</span><span class="o">.</span><span class="na">forHttp</span><span class="o">(</span><span class="s">"/api/messages"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">forPort</span><span class="o">(</span><span class="mi">80</span><span class="o">)</span>
        <span class="o">.</span><span class="na">forStatusCode</span><span class="o">(</span><span class="mi">200</span><span class="o">));</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">(</span><span class="nc">ConfigurableApplicationContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">smtp4devContainer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        
        <span class="nc">TestPropertyValues</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
        <span class="s">"spring.mail.host="</span> <span class="o">+</span> <span class="n">smtp4devContainer</span><span class="o">.</span><span class="na">getHost</span><span class="o">(),</span>
        <span class="s">"spring.mail.port="</span> <span class="o">+</span> <span class="n">smtp4devContainer</span><span class="o">.</span><span class="na">getMappedPort</span><span class="o">(</span><span class="mi">25</span><span class="o">)</span>
        <span class="o">).</span><span class="na">applyTo</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getEnvironment</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Nu in een test:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootTest</span>
<span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="n">initializers</span> <span class="o">=</span> <span class="nc">Smtp4devTestContainerInitializer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">KrustyKrabEmailServiceTest</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nc">EmailService</span> <span class="n">emailService</span><span class="o">;</span>
    
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">givenBikiniBottomCitizen_whenSendingWelcome_thenMessageSends</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">emailService</span><span class="o">.</span><span class="na">sendWelcome</span><span class="o">(</span><span class="s">"patrick.star@bikinibottom.com"</span><span class="o">);</span>
        
        <span class="nc">RestTemplate</span> <span class="n">rest</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RestTemplate</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">messagesApi</span> <span class="o">=</span> <span class="s">"http://"</span> <span class="o">+</span>
        <span class="nc">Smtp4devTestContainerInitializer</span><span class="o">.</span><span class="na">smtp4devContainer</span><span class="o">.</span><span class="na">getHost</span><span class="o">()</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span>
        <span class="nc">Smtp4devTestContainerInitializer</span><span class="o">.</span><span class="na">smtp4devContainer</span><span class="o">.</span><span class="na">getMappedPort</span><span class="o">(</span><span class="mi">80</span><span class="o">)</span> <span class="o">+</span>
        <span class="s">"/api/messages"</span><span class="o">;</span>
        
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;&gt;</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">rest</span><span class="o">.</span><span class="na">getForObject</span><span class="o">(</span><span class="n">messagesApi</span><span class="o">,</span> <span class="nc">List</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        
        <span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">messages</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">messages</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">"subject"</span><span class="o">).</span><span class="na">toString</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"Welcome"</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Belangrijke punten:</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">withExposedPorts(80, 25)</code></strong> → web UI + SMTP poort openstellen</li>
  <li><strong><code class="language-plaintext highlighter-rouge">waitingFor(Wait.forHttp(...))</code></strong> → wachten tot de API echt klaar is</li>
  <li><strong><code class="language-plaintext highlighter-rouge">TestPropertyValues</code></strong> → configureert container-instellingen in Spring</li>
</ul>

<p>Wil je <strong>Mailpit</strong> gebruiken? Zo ziet de initializer eruit:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MailpitTestContainerInitializer</span> <span class="kd">implements</span> <span class="nc">ApplicationContextInitializer</span><span class="o">&lt;</span><span class="nc">ConfigurableApplicationContext</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">GenericContainer</span><span class="o">&lt;?&gt;</span> <span class="n">mailpitContainer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GenericContainer</span><span class="o">&lt;&gt;(</span><span class="nc">DockerImageName</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"axllent/mailpit:v1.27.8"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">withExposedPorts</span><span class="o">(</span><span class="mi">8025</span><span class="o">,</span> <span class="mi">1025</span><span class="o">)</span>
        <span class="o">.</span><span class="na">waitingFor</span><span class="o">(</span><span class="nc">Wait</span><span class="o">.</span><span class="na">forHttp</span><span class="o">(</span><span class="s">"/api/v1/messages"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">forPort</span><span class="o">(</span><span class="mi">8025</span><span class="o">)</span>
        <span class="o">.</span><span class="na">forStatusCode</span><span class="o">(</span><span class="mi">200</span><span class="o">));</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">(</span><span class="nc">ConfigurableApplicationContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mailpitContainer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        
        <span class="nc">TestPropertyValues</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
        <span class="s">"spring.mail.host="</span> <span class="o">+</span> <span class="n">mailpitContainer</span><span class="o">.</span><span class="na">getHost</span><span class="o">(),</span>
        <span class="s">"spring.mail.port="</span> <span class="o">+</span> <span class="n">mailpitContainer</span><span class="o">.</span><span class="na">getMappedPort</span><span class="o">(</span><span class="mi">1025</span><span class="o">)</span>
        <span class="o">).</span><span class="na">applyTo</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getEnvironment</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Verschillen:</p>

<ul>
  <li>Poort 8025 voor web UI (ipv 80 bij smtp4dev)</li>
  <li>Poort 1025 voor SMTP (ipv 25)</li>
  <li>API pad <code class="language-plaintext highlighter-rouge">/api/v1/messages</code> ipv <code class="language-plaintext highlighter-rouge">/api/messages</code></li>
</ul>

<p>Beide werken identiek in je tests. Kies smtp4dev voor geavanceerde relay-features of bestaande projecten, Mailpit voor snelle opstart en kleine Docker footprint.</p>

<h3 id="postgresql-met-initialisatie-scripts">PostgreSQL met Initialisatie Scripts</h3>

<p>Soms wil ik geen lege database, maar schema + seed data laden:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestDatabaseInitializer</span> <span class="kd">implements</span> <span class="nc">ApplicationContextInitializer</span><span class="o">&lt;</span><span class="nc">ConfigurableApplicationContext</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">PostgreSQLContainer</span><span class="o">&lt;?&gt;</span> <span class="n">postgres</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PostgreSQLContainer</span><span class="o">&lt;&gt;(</span><span class="s">"postgres:16-alpine"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withDatabaseName</span><span class="o">(</span><span class="s">"myapp"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withCopyFileToContainer</span><span class="o">(</span><span class="nc">MountableFile</span><span class="o">.</span><span class="na">forClasspathResource</span><span class="o">(</span><span class="s">"init_schema.sql"</span><span class="o">),</span> <span class="s">"/docker-entrypoint-initdb.d/"</span><span class="o">);</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">(</span><span class="nc">ConfigurableApplicationContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">postgres</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        
        <span class="nc">TestPropertyValues</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
        <span class="s">"spring.datasource.url="</span> <span class="o">+</span> <span class="n">postgres</span><span class="o">.</span><span class="na">getJdbcUrl</span><span class="o">(),</span>
        <span class="s">"spring.datasource.username="</span> <span class="o">+</span> <span class="n">postgres</span><span class="o">.</span><span class="na">getUsername</span><span class="o">(),</span>
        <span class="s">"spring.datasource.password="</span> <span class="o">+</span> <span class="n">postgres</span><span class="o">.</span><span class="na">getPassword</span><span class="o">()</span>
        <span class="o">).</span><span class="na">applyTo</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getEnvironment</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>De truc: <strong><code class="language-plaintext highlighter-rouge">withCopyFileToContainer</code></strong> → schema in <code class="language-plaintext highlighter-rouge">/docker-entrypoint-initdb.d/</code> plaatsen. Postgres voert dit automatisch uit bij opstart.</p>

<h2 id="gespecialiseerde-containers-vs-genericcontainer">Gespecialiseerde Containers vs GenericContainer</h2>

<p>Je ziet dat ik zowel <code class="language-plaintext highlighter-rouge">PostgreSQLContainer</code> als <code class="language-plaintext highlighter-rouge">GenericContainer</code> heb gebruikt.</p>

<p>Regel van thumb:</p>

<ul>
  <li><strong>Gebruik gespecialiseerde containers</strong> als ze bestaan (<code class="language-plaintext highlighter-rouge">PostgreSQLContainer</code>, <code class="language-plaintext highlighter-rouge">MongoDBContainer</code>, <code class="language-plaintext highlighter-rouge">KafkaContainer</code>, …) → handige defaults en shortcuts</li>
  <li><strong>Gebruik <code class="language-plaintext highlighter-rouge">GenericContainer</code></strong> voor alles wat geen module heeft (smtp4dev, Mailpit, custom images)</li>
</ul>

<p>Denk aan <code class="language-plaintext highlighter-rouge">GenericContainer</code> als het <strong>Zwitsers zakmes</strong> van Testcontainers. Alles anders bouwt hierop voort.</p>

<h2 id="tips-uit-de-praktijk">Tips uit de praktijk</h2>

<h4 id="containers-hergebruiken-over-tests"><strong>Containers hergebruiken over tests</strong></h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Container</span>
<span class="kd">static</span> <span class="nc">PostgreSQLContainer</span><span class="o">&lt;?&gt;</span> <span class="n">postgres</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PostgreSQLContainer</span><span class="o">&lt;&gt;(</span><span class="s">"postgres:16.3"</span><span class="o">);</span>
</code></pre></div></div>

<p>Maak ze <code class="language-plaintext highlighter-rouge">static</code> om herstarten per methode te vermijden. Waarom dit belangrijk is:</p>

<p align="center">
    <img src="/assets/img/static_1.svg" alt="Zonder static" style="height: 550px; margin-bottom: -400px; margin-top: -200px" />
    <img src="/assets/img/static_2.svg" alt="Met static" style="height: 550px; margin-top: -100px; margin-bottom: -200px" />
</p>

<h4 id="pin-image-versies"><strong>Pin image versies</strong></h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">new</span> <span class="nc">PostgreSQLContainer</span><span class="o">&lt;&gt;(</span><span class="s">"postgres:16-alpine"</span><span class="o">);</span> <span class="c1">// stabiel</span>
<span class="k">new</span> <span class="nc">PostgreSQLContainer</span><span class="o">&lt;&gt;(</span><span class="s">"postgres:latest"</span><span class="o">);</span> <span class="c1">// risicovol</span>
</code></pre></div></div>

<h4 id="initializers-delen-tussen-testklassen"><strong>Initializers delen</strong> tussen testklassen</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootTest</span>
<span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="n">initializers</span> <span class="o">=</span> <span class="o">{</span>
<span class="nc">TestDatabaseInitializer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
<span class="nc">Smtp4devTestContainerInitializer</span><span class="o">.</span><span class="na">class</span>
<span class="o">})</span>
<span class="kd">class</span> <span class="nc">MyIntegrationTest</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</code></pre></div></div>

<h4 id="maak-je-geen-zorgen-om-test-snelheid"><strong>Maak je geen zorgen om test snelheid</strong></h4>

<p>Ja, Docker-containers nemen een paar seconden om te starten.
Maar met static containers en hergebruik is de opstarttijd minimaal vergeleken met de zekerheid die je krijgt.
Mijn test suite met PostgreSQL en smtp4dev voegt misschien 5–10 seconden toe — de moeite waard.</p>

<h4 id="check-logs-bij-debuggen"><strong>Check logs bij debuggen</strong></h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">postgres</span><span class="o">.</span><span class="na">getLogs</span><span class="o">());</span>
</code></pre></div></div>

<h2 id="afronden">Afronden</h2>

<p>Testcontainers heeft mijn manier van integratietesten volledig veranderd.</p>

<p>Ik begon met <code class="language-plaintext highlighter-rouge">@Container</code> en <code class="language-plaintext highlighter-rouge">@DynamicPropertySource</code> voor eenvoudige gevallen.
Wanneer ik meer controle nodig had, gebruikte ik <code class="language-plaintext highlighter-rouge">ApplicationContextInitializer</code>.
En bij testen tegen elke Docker image bood <code class="language-plaintext highlighter-rouge">GenericContainer</code> uitkomst.</p>

<p>Het mooie: ik test altijd <strong>tegen het echte werk</strong>.
Echte databases, echte SMTP-servers, echte API’s, zonder de traditionele ellende van lokaal beheer.</p>

<p>Als je Testcontainers nog niet gebruikt, probeer het dan zeker in je volgende Spring Boot-project.
Je toekomstige zelf (en je team) zal je dankbaar zijn.</p>

<p>Ga nu aan de slag en containerize je tests!</p>

<h2 id="bronnen">Bronnen</h2>

<p><strong>Officiële documentatie:</strong></p>

<ul>
  <li><a href="https://www.testcontainers.org/">Testcontainers Official Documentation</a></li>
  <li><a href="https://java.testcontainers.org/">Testcontainers for Java</a></li>
  <li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.testing">Spring Boot Testing Documentation</a></li>
</ul>

<p><strong>Docker images gebruikt:</strong></p>

<ul>
  <li><a href="https://hub.docker.com/_/postgres">PostgreSQL on Docker Hub</a></li>
  <li><a href="https://github.com/rnwood/smtp4dev">smtp4dev on GitHub</a></li>
  <li><a href="https://github.com/axllent/mailpit">Mailpit on GitHub</a></li>
</ul>

<p><strong>Gerelateerde tools:</strong></p>

<ul>
  <li><a href="https://www.docker.com/products/docker-desktop/">Docker Desktop</a></li>
  <li><a href="https://mvnrepository.com/artifact/org.testcontainers">Maven Central - Testcontainers</a></li>
</ul>


            </div>
        </div>

        
        <aside class="post-sidebar">
            
            <div class="sidebar-section author-info">
                <h3>Auteur</h3>
                <p class="author-name">Oumaima Zerouali</p>
                <p class="author-title">Software Developer</p>
            </div>

            
            <div class="sidebar-section">
                <a href="https://github.com/OumaimaZerouali/OumaimaZerouali.github.io/edit/master/_posts/nl/2025-10-05-testcontainers.md"
                   class="sidebar-button"
                   target="_blank"
                   rel="noopener noreferrer"
                   aria-label="Suggest an edit to this post on GitHub">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                    <span>Stel een wijziging voor</span>
                </a>
            </div>

            
            
            
            

            

            
            <div class="sidebar-section">
                <h3>Gerelateerde Artikelen</h3>
                <ul class="sidebar-links">
                    
                    <li>
                        <a href="/nl/2026/01/22/migration-to-java-25/">Migratie naar Java 25 en Spring Boot 4: eerlijk, het was chaos</a>
                    </li>
                    
                    <li>
                        <a href="/nl/2025/08/05/exceptions-should-be-exceptional/">Exceptions: De Noodrem, niet de stuurwiel</a>
                    </li>
                    
                </ul>
            </div>
            
            

            
            <div class="sidebar-section sidebar-comments">
                <h3>Reacties</h3>
                <div class="giscus-wrapper"></div>
            </div>
        </aside>
    </div>
</article>


    </div>
</main><footer class="site-footer" role="contentinfo">
    <div class="wrapper">
        <div class="footer-content">
            

            <div class="footer-left">
                <button id="cookie-settings-link" class="cookie-settings-link" type="button" aria-label="Cookie-instellingen">
                    Cookie-instellingen
                </button>
            </div>

            <div class="footer-center">
                <p>&copy; 2026 Oumaima Zerouali · <a href="https://jcast.dev" target="_blank" rel="noopener noreferrer" class="jcast-link">JCast<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></p>
            </div>

            <div class="footer-social-links">
                <a href="https://www.linkedin.com/in/oumaima-zerouali-16b189223" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn profile">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                        <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
                        <rect x="2" y="9" width="4" height="12"></rect>
                        <circle cx="4" cy="4" r="2"></circle>
                    </svg>
                </a>
                <a href="https://github.com/OumaimaZerouali" target="_blank" rel="noopener noreferrer" aria-label="GitHub profile">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                        <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
                    </svg>
                </a>
                <a href="https://www.instagram.com/_oumietje_/" target="_blank" rel="noopener noreferrer" aria-label="Instagram profile">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                        <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                        <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                        <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                    </svg>
                </a>
            </div>
        </div>
    </div>
</footer>


<div id="cookie-banner" class="cookie-banner" role="dialog" aria-live="polite" aria-label="Cookie consent" hidden>
    <div class="cookie-banner-content">
        <p class="cookie-banner-message">
            We gebruiken cookies om je ervaring te verbeteren. Mogen we analytics-cookies gebruiken?
        </p>
        <div class="cookie-banner-actions">
            <button id="cookie-accept" class="cookie-btn cookie-btn-accept" type="button">
                Accepteren
            </button>
            <button id="cookie-decline" class="cookie-btn cookie-btn-decline" type="button">
                Weigeren
            </button>
        </div>
    </div>
</div>
<script src="/assets/js/mobile-menu.js"></script>
<script src="/assets/js/lang-switcher.js"></script>
<script src="/assets/js/theme-toggle.js"></script>
<script src="/assets/js/code-copy.js"></script>
<script src="/assets/js/cookie-consent.js"></script>
<script src="/assets/js/giscus-init.js"></script>
<script src="/assets/js/giscus-theme.js"></script>

</body>
</html>
