<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testcontainers in Spring Boot: From Quick Wins to Power Moves | Oumi's Blog</title>
    <meta name="description" content="Thoughtful reflections on software development, written by a developer for developers.
">


    <link rel="canonical" href="http://localhost:4000/2025/10/05/testcontainers/" />

    <meta property="og:title" content="Testcontainers in Spring Boot: From Quick Wins to Power Moves" />
    <meta property="og:description" content="Thoughtful reflections on software development, written by a developer for developers.
" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="http://localhost:4000/2025/10/05/testcontainers/" />
    
    <meta property="og:image" content="http://localhost:4000/assets/img/spongebob-testcontainers.png" />
    

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Testcontainers in Spring Boot: From Quick Wins to Power Moves" />
    <meta name="twitter:description" content="Thoughtful reflections on software development, written by a developer for developers.
" />
    
    <meta name="twitter:image" content="http://localhost:4000/assets/img/spongebob-testcontainers.png" />
    

    <script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebSite","name":"Oumi's Blog","url":"http://localhost:4000","description":"Thoughtful reflections on software development, written by a developer for developers.","publisher":{"@type":"Person","name":"Oumaima Zerouali","url":"http://localhost:4000"}}
</script>
    <script type="application/ld+json">
{"@context":"https://schema.org","@type":"Person","name":"Oumaima Zerouali","url":"http://localhost:4000","image":"http://localhost:4000/assets/favicon/logo.svg","jobTitle":"Software Developer","sameAs":["https://github.com/OumaimaZerouali","https://www.linkedin.com/in/oumaima-zerouali-16b189223","https://www.instagram.com/_oumietje_","https://jcast.dev"],"affiliation":{"@type":"Organization","@id":"https://jcast.dev/#org","name":"JCast","url":"https://jcast.dev"}}
</script>

    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="icon" type="image/x-icon" href="/assets/favicon/favicon.ico">
</head>
<body>

<div id="live-announcer" role="status" aria-live="polite" aria-atomic="true" class="sr-only"></div>

<a href="#main-content" class="skip-link">Skip to main content</a><header class="site-header">
  <div class="wrapper">
    
    

    
      <a class="site-title" href="/">
        <img src="/assets/favicon/logo.svg" alt="Oumi's Blog" class="site-logo">
        <span class="site-title-text">Oumi's Blog</span>
      </a>
    

    <button class="hamburger mobile-only" id="hamburger-toggle" aria-label="Toggle menu" aria-expanded="false">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>

    <nav class="site-nav" role="navigation" aria-label="Main navigation">
      <a href="/posts">Posts</a>
      <a href="/about">About</a>

      <div class="lang-switcher desktop-only" role="group" aria-label="Language switcher">
        <button class="lang-link" data-lang="en" id="lang-en" aria-label="Switch to English" aria-pressed="true">EN</button>
        <span class="lang-separator" aria-hidden="true">/</span>
        <button class="lang-link" data-lang="nl" id="lang-nl" aria-label="Switch to Dutch" aria-pressed="false">NL</button>
      </div>

      <button id="theme-toggle" class="desktop-only" aria-label="Toggle theme">
        <svg id="icon-sun" class="hidden"
             xmlns="http://www.w3.org/2000/svg" width="20" height="20"
             viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>

        <svg id="icon-moon" class="hidden"
             xmlns="http://www.w3.org/2000/svg" width="20" height="20"
             viewBox="0 0 24 24" fill="currentColor">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
      </button>

      <div class="mobile-only mobile-controls">
        <button class="mobile-action" id="mobile-switch-theme">Switch theme</button>
        
        <a class="mobile-action" href="/nl/">Switch to Dutch</a>
        
      </div>
    </nav>
  </div>
</header>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const hamburger = document.getElementById('hamburger-toggle');
  const nav = document.querySelector('.site-nav');
  const mobileSwitchTheme = document.getElementById('mobile-switch-theme');

  function closeMenu() {
    hamburger.setAttribute('aria-expanded', 'false');
    hamburger.classList.remove('active');
    nav.classList.remove('active');
  }

  function openMenu() {
    hamburger.setAttribute('aria-expanded', 'true');
    hamburger.classList.add('active');
    nav.classList.add('active');
  }

  if (hamburger) {
    hamburger.addEventListener('click', function(event) {
      const isExpanded = hamburger.getAttribute('aria-expanded') === 'true';
      if (isExpanded) closeMenu(); else openMenu();
      event.stopPropagation();
    });
  }

  document.addEventListener('click', function(event) {
    if (!nav.contains(event.target) && !hamburger.contains(event.target)) {
      closeMenu();
    }
  });

  document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape' || event.key === 'Esc') {
      if (nav.classList.contains('active')) {
        closeMenu();
        hamburger.focus();
      }
    }
  });

  if (mobileSwitchTheme) {
    mobileSwitchTheme.addEventListener('click', function() {
      const html = document.documentElement;
      const current = html.getAttribute('data-theme');
      const newTheme = current === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', newTheme);

      // Announce theme change to screen readers
      const liveAnnouncer = document.getElementById('live-announcer');
      if (liveAnnouncer) {
        liveAnnouncer.textContent = `Theme switched to ${newTheme} mode`;
      }
    });
  }

  const navLinks = nav.querySelectorAll('a');
  navLinks.forEach(link => link.addEventListener('click', () => setTimeout(closeMenu, 50)));
});
</script>
<main id="main-content">
    <div class="wrapper">
        
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","headline":"Testcontainers in Spring Boot: From Quick Wins to Power Moves","description":"  “Testcontainers is like having SpongeBob at the helm of your CI: cheerful, reliable, and somehow turning chaos into perfection.” - Me","author":{"@type":"Person","name":"Oumaima Zerouali","url":"http://localhost:4000"},"datePublished":"2025-10-05T09:00:00+02:00","dateModified":"2025-10-05T09:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2025/10/05/testcontainers/"},"publisher":{"@type":"Person","name":"Oumaima Zerouali"},"image":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/spongebob-testcontainers.png"}}
</script>


<article class="post">
    <header class="post-header">
        <h1 class="post-title">Testcontainers in Spring Boot: From Quick Wins to Power Moves</h1>
        <div class="post-meta">
            <time datetime="2025-10-05T09:00:00+02:00">October 05, 2025</time>
        </div>
    </header>

    
    <div class="post-image">
        <img
            src="/assets/img/spongebob-testcontainers.png"
            alt="Testcontainers in Spring Boot: From Quick Wins to Power Moves"
            loading="lazy"
            decoding="async"
        />
    </div>
    

    <div class="post-content">
        <blockquote>
  <p>“Testcontainers is like having SpongeBob at the helm of your CI: cheerful, reliable, and somehow turning chaos into perfection.” - Me</p>
</blockquote>

<p>As a junior developer, I’m constantly learning new tools and practices.
One lesson from my seniors that really stuck with me was this: <em>mocking will only take you so far</em>.
At some point, you need to test against the real thing: a real database, a real message broker, a real service.</p>

<p>That’s when I discovered <strong>Testcontainers</strong>, and it completely changed how I write integration tests in Java and Spring Boot.
After experimenting with it and sharing my findings with colleagues, I realized I wanted to capture everything I’d learned in one place.</p>

<p>This post is my attempt to do just that: explaining the why, the how, and the real-world patterns I now use in my projects.</p>

<h2 id="the-problem-i-used-to-have">The Problem I Used to Have</h2>
<p>I have to admit.
I used to avoid integration tests whenever I could.
Mocks were my best friends: fast, predictable, and easy to set up.</p>

<p>But as much as I loved them, some things just can’t be faked.
A mail server, a real PostgreSQL database, no amount of mocking could truly replicate them.</p>

<p>I quickly ran into the same frustrating scenarios we’ve all seen: tests that pass on my machine but fail in CI, or teammates spending hours just to get the environment ready to run tests.</p>

<p>For a Spring Boot app that needs PostgreSQL and sends emails, here’s how the options stack up:</p>

<table>
  <thead>
    <tr>
      <th>Approach</th>
      <th>Pros</th>
      <th>Cons</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Local Installation</strong><br />Install PostgreSQL &amp; SMTP locally</td>
      <td>- Tests against real services<br /> - No mocking</td>
      <td>- Different versions across machines<br /> - “Works on my laptop” syndrome<br /> - Painful CI setup<br /> - Leftover test data pollution</td>
    </tr>
    <tr>
      <td><strong>Mock Everything</strong><br />Use mock databases &amp; services</td>
      <td>- Fast test execution<br /> - No external dependencies</td>
      <td>- Not testing real integration<br /> - Mocks drift from reality<br /> - False confidence</td>
    </tr>
    <tr>
      <td><strong>Testcontainers</strong><br />Real services in Docker</td>
      <td>- Real integration testing<br /> - Consistent across all machines<br /> - Zero installation hassle<br /> - Clean state every run</td>
      <td>- Requires Docker<br /> - Slightly slower than mocks</td>
    </tr>
  </tbody>
</table>

<p><strong>Testcontainers</strong> was the game-changer I needed.</p>

<h2 id="quick-setup">Quick Setup</h2>

<p>Before I dive deep, let me get you set up:</p>

<p><strong>Prerequisites:</strong></p>
<ul>
  <li>Java <strong>21+</strong></li>
  <li>Maven</li>
  <li>Docker Desktop running</li>
</ul>

<p><strong>Add the dependencies:</strong></p>

<p>Maven:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.testcontainers<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>junit-jupiter<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.testcontainers<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>postgresql<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<h2 id="the-standard-approach-good-but-limited">The Standard Approach (Good, But Limited)</h2>

<p>Here’s what most tutorials show you, and honestly, it’s great for simple cases:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Testcontainers</span>
<span class="nd">@DataJpaTest</span>
<span class="kd">class</span> <span class="nc">UserRepositoryTest</span> <span class="o">{</span>

    <span class="nd">@Container</span>
    <span class="kd">static</span> <span class="nc">PostgreSQLContainer</span><span class="o">&lt;?&gt;</span> <span class="n">postgres</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PostgreSQLContainer</span><span class="o">&lt;&gt;(</span><span class="s">"postgres:16-alpine"</span><span class="o">);</span>
    
    <span class="nd">@DynamicPropertySource</span>
    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">configureProperties</span><span class="o">(</span><span class="nc">DynamicPropertyRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.datasource.url"</span><span class="o">,</span> <span class="nl">postgres:</span><span class="o">:</span><span class="n">getJdbcUrl</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.datasource.username"</span><span class="o">,</span> <span class="nl">postgres:</span><span class="o">:</span><span class="n">getUsername</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.datasource.password"</span><span class="o">,</span> <span class="nl">postgres:</span><span class="o">:</span><span class="n">getPassword</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="nd">@Autowired</span>
    <span class="nc">UserRepository</span> <span class="n">userRepository</span><span class="o">;</span>
    
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">givenNewUser_whenSaving_thenUserIsPersisted</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="s">"Spongebob"</span><span class="o">);</span>
        <span class="n">userRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">().</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This is <strong>beautiful</strong> for simple cases. JUnit starts a PostgreSQL container, Spring Boot wires it up via <code class="language-plaintext highlighter-rouge">@DynamicPropertySource</code>, your test runs against a real database, and the container gets cleaned up afterward.</p>

<h3 id="what-actually-happens-behind-the-scenes">What Actually Happens Behind the Scenes?</h3>

<p>When you hit “Run Test”, here’s the magic that unfolds (simplified):</p>

<p align="center">
    <img src="/assets/img/simplified.svg" alt="Behind the scenes (simplified)" style="height: 550px" />
</p>

<p>The waiting phase is crucial. 
Testcontainers doesn’t just check if the port is open, it waits until the service is actually ready to accept connections. 
This is why your tests “just work” without flaky failures.</p>

<p>But in real projects, I quickly ran into situations where I needed to:</p>

<ul>
  <li>Start multiple containers that talk to each other</li>
  <li>Preload my database with schema or seed data</li>
  <li>Wait for a REST API to be ready, not just a port</li>
  <li>Test email sending against a fake SMTP server</li>
</ul>

<p>That’s where things get interesting….</p>

<h2 id="level-up-applicationcontextinitializer">Level Up: ApplicationContextInitializer</h2>

<p>When I need more control, Spring Boot gives me a powerful hook:
<strong><code class="language-plaintext highlighter-rouge">ApplicationContextInitializer&lt;ConfigurableApplicationContext&gt;</code></strong>.</p>

<p>This runs <strong>before</strong> your application context starts, letting you:</p>

<ul>
  <li>Start containers manually with full control</li>
  <li>Configure complex wait strategies</li>
  <li>Inject custom properties into Spring’s environment</li>
  <li>Reuse container configurations across multiple test classes</li>
</ul>

<p>I think of it as the “professional” way to wire up Testcontainers in Spring Boot.</p>

<h3 id="how-the-professional-setup-works">How the Professional Setup Works</h3>

<p>Here’s what happens when you use <code class="language-plaintext highlighter-rouge">ApplicationContextInitializer</code>:</p>

<p align="center">
    <img src="/assets/img/testcontainers.svg" alt="What happens when you use ApplicationContextInitializer" style="height: 550px" />
</p>

<p>This gives you complete control over the startup sequence and lets you configure containers exactly how you need them.</p>

<h3 id="real-world-example-testing-email-with-smtp4dev-or-mailpit">Real-World Example: Testing Email with smtp4dev (or Mailpit)</h3>

<p>My app sends emails, and I needed to test that realistically without spamming real inboxes.</p>

<p><strong>smtp4dev</strong> is a fake SMTP server that catches emails and exposes them via REST API. 
It’s been around for years, has a mature codebase, and includes features like relay testing and authentication simulation. 
Perfect for comprehensive email testing scenarios.</p>

<p><strong>Mailpit</strong> is a modern alternative written in Go, known for its lightweight footprint, faster startup times, and slick UI. 
It also has excellent search capabilities and built-in spam score analysis. 
If you’re starting fresh, Mailpit is often the go-to choice in 2025, but smtp4dev remains solid for existing projects.</p>

<p>Both expose REST APIs for programmatic testing, support SMTP authentication, and provide web UIs for manual inspection. 
The main differences:</p>

<ul>
  <li><strong>Performance</strong>: Mailpit starts faster and uses less memory (~10-20MB vs ~50-100MB)</li>
  <li><strong>UI</strong>: Mailpit has a more modern, responsive interface</li>
  <li><strong>Features</strong>: smtp4dev has more enterprise features (relay, conditional rules); Mailpit focuses on simplicity</li>
  <li><strong>Docker size</strong>: Mailpit image is smaller (~15MB vs ~200MB)</li>
</ul>

<p>For most Spring Boot integration tests, either works great. 
I’ll show you smtp4dev here, but switching to Mailpit is as simple as changing the image name.</p>

<p>Here’s smtp4dev in action:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Smtp4devTestContainerInitializer</span> <span class="kd">implements</span> <span class="nc">ApplicationContextInitializer</span><span class="o">&lt;</span><span class="nc">ConfigurableApplicationContext</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">GenericContainer</span><span class="o">&lt;?&gt;</span> <span class="n">smtp4devContainer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GenericContainer</span><span class="o">&lt;&gt;(</span><span class="nc">DockerImageName</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"rnwood/smtp4dev:3.10.3"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">withExposedPorts</span><span class="o">(</span><span class="mi">80</span><span class="o">,</span> <span class="mi">25</span><span class="o">)</span>
        <span class="o">.</span><span class="na">waitingFor</span><span class="o">(</span><span class="nc">Wait</span><span class="o">.</span><span class="na">forHttp</span><span class="o">(</span><span class="s">"/api/messages"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">forPort</span><span class="o">(</span><span class="mi">80</span><span class="o">)</span>
        <span class="o">.</span><span class="na">forStatusCode</span><span class="o">(</span><span class="mi">200</span><span class="o">));</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">(</span><span class="nc">ConfigurableApplicationContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">smtp4devContainer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        
        <span class="nc">TestPropertyValues</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
        <span class="s">"spring.mail.host="</span> <span class="o">+</span> <span class="n">smtp4devContainer</span><span class="o">.</span><span class="na">getHost</span><span class="o">(),</span>
        <span class="s">"spring.mail.port="</span> <span class="o">+</span> <span class="n">smtp4devContainer</span><span class="o">.</span><span class="na">getMappedPort</span><span class="o">(</span><span class="mi">25</span><span class="o">)</span>
        <span class="o">).</span><span class="na">applyTo</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getEnvironment</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now in a test:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootTest</span>
<span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="n">initializers</span> <span class="o">=</span> <span class="nc">Smtp4devTestContainerInitializer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">KrustyKrabEmailServiceTest</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nc">EmailService</span> <span class="n">emailService</span><span class="o">;</span>
    
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">givenBikiniBottomCitizen_whenSendingWelcome_thenMessageSends</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">emailService</span><span class="o">.</span><span class="na">sendWelcome</span><span class="o">(</span><span class="s">"patrick.star@bikinibottom.com"</span><span class="o">);</span>
        
        <span class="nc">RestTemplate</span> <span class="n">rest</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RestTemplate</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">messagesApi</span> <span class="o">=</span> <span class="s">"http://"</span> <span class="o">+</span>
        <span class="nc">Smtp4devTestContainerInitializer</span><span class="o">.</span><span class="na">smtp4devContainer</span><span class="o">.</span><span class="na">getHost</span><span class="o">()</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span>
        <span class="nc">Smtp4devTestContainerInitializer</span><span class="o">.</span><span class="na">smtp4devContainer</span><span class="o">.</span><span class="na">getMappedPort</span><span class="o">(</span><span class="mi">80</span><span class="o">)</span> <span class="o">+</span>
        <span class="s">"/api/messages"</span><span class="o">;</span>
        
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;&gt;</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">rest</span><span class="o">.</span><span class="na">getForObject</span><span class="o">(</span><span class="n">messagesApi</span><span class="o">,</span> <span class="nc">List</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        
        <span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">messages</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">messages</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">"subject"</span><span class="o">).</span><span class="na">toString</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"Welcome"</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Key things:</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">withExposedPorts(80, 25)</code></strong> exposes the web UI + SMTP port</li>
  <li><strong><code class="language-plaintext highlighter-rouge">waitingFor(Wait.forHttp(...))</code></strong> waits until the API is really alive</li>
  <li><strong><code class="language-plaintext highlighter-rouge">TestPropertyValues</code></strong> wires the container config into Spring</li>
</ul>

<p>Want to use <strong>Mailpit</strong> instead? Here’s the equivalent initializer:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MailpitTestContainerInitializer</span> <span class="kd">implements</span> <span class="nc">ApplicationContextInitializer</span><span class="o">&lt;</span><span class="nc">ConfigurableApplicationContext</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">GenericContainer</span><span class="o">&lt;?&gt;</span> <span class="n">mailpitContainer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GenericContainer</span><span class="o">&lt;&gt;(</span><span class="nc">DockerImageName</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"axllent/mailpit:v1.27.8"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">withExposedPorts</span><span class="o">(</span><span class="mi">8025</span><span class="o">,</span> <span class="mi">1025</span><span class="o">)</span>
        <span class="o">.</span><span class="na">waitingFor</span><span class="o">(</span><span class="nc">Wait</span><span class="o">.</span><span class="na">forHttp</span><span class="o">(</span><span class="s">"/api/v1/messages"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">forPort</span><span class="o">(</span><span class="mi">8025</span><span class="o">)</span>
        <span class="o">.</span><span class="na">forStatusCode</span><span class="o">(</span><span class="mi">200</span><span class="o">));</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">(</span><span class="nc">ConfigurableApplicationContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mailpitContainer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        
        <span class="nc">TestPropertyValues</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
        <span class="s">"spring.mail.host="</span> <span class="o">+</span> <span class="n">mailpitContainer</span><span class="o">.</span><span class="na">getHost</span><span class="o">(),</span>
        <span class="s">"spring.mail.port="</span> <span class="o">+</span> <span class="n">mailpitContainer</span><span class="o">.</span><span class="na">getMappedPort</span><span class="o">(</span><span class="mi">1025</span><span class="o">)</span>
        <span class="o">).</span><span class="na">applyTo</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getEnvironment</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The key differences:</p>
<ul>
  <li>Port 8025 for web UI (vs 80 in smtp4dev)</li>
  <li>Port 1025 for SMTP (vs 25)</li>
  <li>API path is <code class="language-plaintext highlighter-rouge">/api/v1/messages</code> instead of <code class="language-plaintext highlighter-rouge">/api/messages</code></li>
</ul>

<p>Both work identically in your tests. Choose smtp4dev if you need advanced relay features or are already using it. Choose Mailpit if you want faster container startup and a smaller Docker footprint.</p>

<h3 id="postgresql-with-initialization-scripts">PostgreSQL with Initialization Scripts</h3>

<p>Sometimes I don’t want an empty database. I want schema + seed data loaded.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestDatabaseInitializer</span> <span class="kd">implements</span> <span class="nc">ApplicationContextInitializer</span><span class="o">&lt;</span><span class="nc">ConfigurableApplicationContext</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">PostgreSQLContainer</span><span class="o">&lt;?&gt;</span> <span class="n">postgres</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PostgreSQLContainer</span><span class="o">&lt;&gt;(</span><span class="s">"postgres:16-alpine"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withDatabaseName</span><span class="o">(</span><span class="s">"myapp"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withCopyFileToContainer</span><span class="o">(</span><span class="nc">MountableFile</span><span class="o">.</span><span class="na">forClasspathResource</span><span class="o">(</span><span class="s">"init_schema.sql"</span><span class="o">),</span> <span class="s">"/docker-entrypoint-initdb.d/"</span><span class="o">);</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">(</span><span class="nc">ConfigurableApplicationContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">postgres</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        
        <span class="nc">TestPropertyValues</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
        <span class="s">"spring.datasource.url="</span> <span class="o">+</span> <span class="n">postgres</span><span class="o">.</span><span class="na">getJdbcUrl</span><span class="o">(),</span>
        <span class="s">"spring.datasource.username="</span> <span class="o">+</span> <span class="n">postgres</span><span class="o">.</span><span class="na">getUsername</span><span class="o">(),</span>
        <span class="s">"spring.datasource.password="</span> <span class="o">+</span> <span class="n">postgres</span><span class="o">.</span><span class="na">getPassword</span><span class="o">()</span>
        <span class="o">).</span><span class="na">applyTo</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getEnvironment</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The trick: <strong><code class="language-plaintext highlighter-rouge">withCopyFileToContainer</code></strong> → place schema in <code class="language-plaintext highlighter-rouge">/docker-entrypoint-initdb.d/</code>. Postgres runs it automatically on startup.</p>

<h2 id="specialized-containers-vs-genericcontainer">Specialized Containers vs GenericContainer</h2>

<p>You might have noticed I used both <code class="language-plaintext highlighter-rouge">PostgreSQLContainer</code> and <code class="language-plaintext highlighter-rouge">GenericContainer</code>.</p>

<p>Here’s the rule of thumb:</p>

<ul>
  <li><strong>Use specialized containers</strong> when they exist (<code class="language-plaintext highlighter-rouge">PostgreSQLContainer</code>, <code class="language-plaintext highlighter-rouge">MongoDBContainer</code>, <code class="language-plaintext highlighter-rouge">KafkaContainer</code>, …).
They give you nice defaults and shortcuts.</li>
  <li><strong>Use <code class="language-plaintext highlighter-rouge">GenericContainer</code></strong> when no module exists (smtp4dev, Mailpit, custom APIs, your own Docker images).</li>
</ul>

<p>Think of <code class="language-plaintext highlighter-rouge">GenericContainer</code> as the <strong>Swiss Army knife</strong> of Testcontainers.
Everything else is built on top of it.</p>

<h2 id="pro-tips-from-my-experience">Pro Tips from My Experience</h2>
<h4 id="reuse-containers-across-tests"><strong>Reuse containers across tests</strong></h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Container</span>
<span class="kd">static</span> <span class="nc">PostgreSQLContainer</span><span class="o">&lt;?&gt;</span> <span class="n">postgres</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PostgreSQLContainer</span><span class="o">&lt;&gt;(</span><span class="s">"postgres:16.3"</span><span class="o">);</span>
</code></pre></div></div>

<p>Make them <code class="language-plaintext highlighter-rouge">static</code> to avoid restarting for every method. Here’s why this matters:</p>

<p align="center">
    <img src="/assets/img/static_1.svg" alt="Without static" style="height: 550px; margin-bottom: -400px; margin-top: -200px" />
    <img src="/assets/img/static_2.svg" alt="With static" style="height: 550px; margin-top: -100px; margin-bottom: -200px" />
</p>

<h4 id="pin-image-versions"><strong>Pin image versions</strong></h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">new</span> <span class="nc">PostgreSQLContainer</span><span class="o">&lt;&gt;(</span><span class="s">"postgres:16-alpine"</span><span class="o">);</span> <span class="c1">// stable</span>
<span class="k">new</span> <span class="nc">PostgreSQLContainer</span><span class="o">&lt;&gt;(</span><span class="s">"postgres:latest"</span><span class="o">);</span> <span class="c1">// risky</span>
</code></pre></div></div>

<h4 id="share-initializers-across-test-classes"><strong>Share initializers</strong> across test classes</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootTest</span>
<span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="n">initializers</span> <span class="o">=</span> <span class="o">{</span>
<span class="nc">TestDatabaseInitializer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
<span class="nc">Smtp4devTestContainerInitializer</span><span class="o">.</span><span class="na">class</span>
<span class="o">})</span>
<span class="kd">class</span> <span class="nc">MyIntegrationTest</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</code></pre></div></div>

<h4 id="dont-worry-too-much-about-test-speed"><strong>Don’t worry too much about test speed</strong></h4>
<p>Yes, Docker containers take a few seconds to start. 
But with static containers and proper reuse, I’ve found the startup cost is negligible compared to the confidence I gain. 
My test suite with PostgreSQL and smtp4dev adds maybe 5-10 seconds total. Well worth it.</p>

<h4 id="check-logs-when-debugging"><strong>Check logs when debugging</strong></h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">postgres</span><span class="o">.</span><span class="na">getLogs</span><span class="o">());</span>
</code></pre></div></div>

<h2 id="wrapping-up">Wrapping Up</h2>
<p>Testcontainers transformed how I think about integration testing.</p>

<p>I started with <code class="language-plaintext highlighter-rouge">@Container</code> and <code class="language-plaintext highlighter-rouge">@DynamicPropertySource</code> for simple cases.
When I needed more control, I reached for <code class="language-plaintext highlighter-rouge">ApplicationContextInitializer</code>.
And when I had to test against any Docker image, <code class="language-plaintext highlighter-rouge">GenericContainer</code> had my back.</p>

<p>The beauty is that I’m always testing against <strong>the real thing</strong>.
Real databases, real SMTP servers, real APIs and this without any of the traditional headaches of managing those services locally.</p>

<p>If you’re not using Testcontainers yet, I encourage you to give it a try on your next Spring Boot project.
Your future self (and your teammates) will thank you.</p>

<p>Now go forth and containerize those tests</p>

<h2 id="resources">Resources</h2>
<p><strong>Official Documentation:</strong></p>
<ul>
  <li><a href="https://www.testcontainers.org/">Testcontainers Official Documentation</a></li>
  <li><a href="https://java.testcontainers.org/">Testcontainers for Java</a></li>
  <li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.testing">Spring Boot Testing Documentation</a></li>
</ul>

<p><strong>Docker Images Used:</strong></p>
<ul>
  <li><a href="https://hub.docker.com/_/postgres">PostgreSQL on Docker Hub</a></li>
  <li><a href="https://github.com/rnwood/smtp4dev">smtp4dev on GitHub</a></li>
  <li><a href="https://github.com/axllent/mailpit">Mailpit on GitHub</a></li>
</ul>

<p><strong>Related Tools:</strong></p>
<ul>
  <li><a href="https://www.docker.com/products/docker-desktop/">Docker Desktop</a></li>
  <li><a href="https://mvnrepository.com/artifact/org.testcontainers">Maven Central - Testcontainers</a></li>
</ul>

    </div>
</article>


    </div>
</main><footer class="site-footer" role="contentinfo">
    <div class="wrapper">
        <div class="footer-content">
            <p>&copy; 2026 Oumaima Zerouali · <a href="https://jcast.dev" target="_blank" rel="noopener noreferrer" class="jcast-link">JCast<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></p>
            <div class="footer-social-links">
                <a href="https://www.linkedin.com/in/oumaima-zerouali-16b189223" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn profile">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                        <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
                        <rect x="2" y="9" width="4" height="12"></rect>
                        <circle cx="4" cy="4" r="2"></circle>
                    </svg>
                </a>
                <a href="https://github.com/OumaimaZerouali" target="_blank" rel="noopener noreferrer" aria-label="GitHub profile">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                        <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
                    </svg>
                </a>
                <a href="https://www.instagram.com/_oumietje_/" target="_blank" rel="noopener noreferrer" aria-label="Instagram profile">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                        <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                        <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                        <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                    </svg>
                </a>
            </div>
        </div>
    </div>
</footer>
<script src="/assets/js/lang-switcher.js"></script>
<script src="/assets/js/theme-toggle.js"></script>

</body>
</html>
